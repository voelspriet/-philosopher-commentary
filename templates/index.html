<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Philosophy Meets Current Events</title>
   <script src="https://cdn.tailwindcss.com"></script>
   <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@300;400;500;600;700&family=SF+Pro+Text:wght@300;400;500;600&display=swap" rel="stylesheet">
   <style>
       .sf-pro { font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif; }
       .sf-text { font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif; }
       .serif { font-family: 'Crimson Text', 'Times New Roman', serif; }
       .mono { font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace; }
       
       .fade-in {
           opacity: 0;
           transform: translateY(20px);
           animation: fadeInUp 0.6s ease-out forwards;
       }
       
       .fade-in:nth-child(1) { animation-delay: 0.1s; }
       .fade-in:nth-child(2) { animation-delay: 0.2s; }
       .fade-in:nth-child(3) { animation-delay: 0.3s; }
       .fade-in:nth-child(4) { animation-delay: 0.4s; }
       .fade-in:nth-child(5) { animation-delay: 0.5s; }
       
       @keyframes fadeInUp {
           to {
               opacity: 1;
               transform: translateY(0);
           }
       }
       
       .quote-marks::before {
           content: '"';
           font-size: 4rem;
           position: absolute;
           left: -2rem;
           top: -1rem;
           color: #e5e7eb;
           font-family: serif;
       }
       
       .philosopher-silhouette {
           width: 60px;
           height: 60px;
           border-radius: 50%;
           background: linear-gradient(135deg, #374151, #6b7280);
           display: flex;
           align-items: center;
           justify-content: center;
           color: white;
           font-size: 24px;
           font-weight: bold;
       }
   </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen sf-pro">
   <div class="container mx-auto px-4 py-12">
       <div class="text-center mb-12">
           <h1 class="text-4xl font-light serif text-gray-900 mb-3">
               Philosophy Meets Current Events
           </h1>
           <p class="text-lg serif text-gray-600 mb-2">A Journal of Contemporary Philosophical Analysis</p>
           <div class="w-24 h-px bg-gray-300 mx-auto mb-4"></div>
           <p class="text-sm sf-text text-gray-500 uppercase tracking-wide">Est. 2025 • Daily Analysis</p>
       </div>

       <div class="grid grid-cols-12 gap-12">
           <div class="col-span-4">
               <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-8">
                   <h2 class="text-xl serif font-medium text-gray-900 mb-8 text-center">Editorial Board</h2>
                   
                   <div class="mb-8">
                       <h3 class="text-sm font-medium text-gray-700 mb-4 sf-text uppercase tracking-wide">Classical School</h3>
                       <div class="grid grid-cols-2 gap-3">
                           {% for id, philosopher in philosophers.items() if philosopher.era == "classical" %}
                           <div class="philosopher-card p-4 rounded-lg cursor-pointer text-center transition-all hover:shadow-md border border-gray-100" 
                                data-id="{{ id }}" onclick="selectPhilosopher('{{ id }}')">
                               <div class="w-8 h-8 rounded-full bg-gray-200 mx-auto mb-2 flex items-center justify-center">
                                   <span class="text-xs font-medium text-gray-600">{{ philosopher.name.split()[0][:2] }}</span>
                               </div>
                               <h3 class="font-medium text-xs serif text-gray-800">{{ philosopher.name.split()[0] }}</h3>
                               <p class="text-xs text-gray-500 sf-text">{{ philosopher.name.split()[-1] if philosopher.name.split()|length > 2 else philosopher.name.split()[1] if philosopher.name.split()|length > 1 else '' }}</p>
                           </div>
                           {% endfor %}
                       </div>
                   </div>
                   
                   <div class="mb-8">
                       <h3 class="text-sm font-medium text-gray-700 mb-4 sf-text uppercase tracking-wide">Contemporary Fellows</h3>
                       <div class="grid grid-cols-2 gap-3">
                           {% for id, philosopher in philosophers.items() if philosopher.era == "contemporary" %}
                           <div class="philosopher-card p-4 rounded-lg cursor-pointer text-center transition-all hover:shadow-md border border-gray-100" 
                                data-id="{{ id }}" onclick="selectPhilosopher('{{ id }}')">
                               <div class="w-8 h-8 rounded-full bg-gray-200 mx-auto mb-2 flex items-center justify-center">
                                   <span class="text-xs font-medium text-gray-600">{{ philosopher.name.split()[0][:2] }}</span>
                               </div>
                               <h3 class="font-medium text-xs serif text-gray-800">{{ philosopher.name.split()[0] }}</h3>
                               <p class="text-xs text-gray-500 sf-text">{{ philosopher.name.split()[-1] if philosopher.name.split()|length > 1 else '' }}</p>
                           </div>
                           {% endfor %}
                       </div>
                   </div>

                   <div class="border-t pt-6">
                       <button id="compare-btn" onclick="toggleCompareMode()" class="w-full py-3 px-4 rounded-lg font-medium text-sm bg-gray-800 text-white hover:bg-gray-900 transition-all sf-text disabled:bg-gray-300" disabled>
                           Comparative Analysis
                       </button>
                       <p class="text-xs text-gray-500 mt-3 sf-text text-center">Select multiple perspectives</p>
                       <div id="selected-count" class="text-xs text-gray-600 mt-2 sf-text text-center">0 selected</div>
                   </div>
               </div>
           </div>

           <div class="col-span-8">
               <div class="flex items-center justify-between mb-8">
                   <h2 class="text-2xl serif font-medium text-gray-900">Current Affairs</h2>
                   <div class="text-xs text-gray-500 sf-text uppercase tracking-wide">Latest Analysis</div>
               </div>
               <div id="news-container" class="space-y-6">
                   <div id="news-loading" class="text-center py-16">
                       <div class="animate-spin rounded-full h-8 w-8 border border-gray-300 border-t-gray-800 mx-auto"></div>
                       <p class="mt-4 text-sm text-gray-500 sf-text">Preparing analysis...</p>
                   </div>
               </div>
           </div>
       </div>
   </div>

   <!-- Modal -->
   <div id="enhanced-modal" class="fixed inset-0 bg-black/40 backdrop-blur-sm hidden z-50 flex items-center justify-center p-4">
       <div class="bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto shadow-xl">
           <div class="sticky top-0 bg-white rounded-t-2xl border-b border-gray-100 p-6">
               <div class="flex justify-between items-start">
                   <div>
                       <h3 id="modal-title" class="text-xl font-medium text-gray-900 sf-pro">Analysis</h3>
                       <p id="modal-subtitle" class="text-sm text-gray-500 sf-text mt-1">Loading...</p>
                       <div id="philosopher-bio" class="mt-3 text-xs text-gray-600 sf-text"></div>
                   </div>
                   <button onclick="closeEnhancedModal()" class="text-gray-400 hover:text-gray-600 text-2xl sf-text">×</button>
               </div>
           </div>
           
           <div id="modal-content" class="p-8">
               <!-- Content will be loaded dynamically -->
           </div>
       </div>
   </div>

   <script>
       let selectedPhilosophers = [];
       let compareMode = false;

       function selectPhilosopher(philosopherId) {
           if (!compareMode) {
               selectedPhilosophers = [philosopherId];
               document.querySelectorAll('.philosopher-card').forEach(card => {
                   card.classList.remove('ring-2', 'ring-white', 'scale-105', 'ring-4', 'ring-yellow-400');
               });
               document.querySelector('[data-id="' + philosopherId + '"]').classList.add('ring-2', 'ring-white', 'scale-105');
               
               updateButtons();
           } else {
               const card = document.querySelector('[data-id="' + philosopherId + '"]');
               if (selectedPhilosophers.includes(philosopherId)) {
                   selectedPhilosophers = selectedPhilosophers.filter(id => id !== philosopherId);
                   card.classList.remove('ring-4', 'ring-yellow-400');
               } else if (selectedPhilosophers.length < 3) {
                   selectedPhilosophers.push(philosopherId);
                   card.classList.add('ring-4', 'ring-yellow-400');
               }
               updateCompareUI();
           }
       }

       function updateButtons() {
           document.querySelectorAll('.button-text').forEach(btn => {
               if (selectedPhilosophers.length > 0) {
                   btn.textContent = 'Analyze';
               } else {
                   btn.textContent = 'Select Analyst';
               }
           });
           
           document.querySelectorAll('button[onclick^="getCommentary"]').forEach(btn => {
               if (selectedPhilosophers.length > 0) {
                   btn.disabled = false;
                   btn.className = 'px-4 py-2 text-xs font-medium sf-text bg-gray-800 text-white hover:bg-gray-900 rounded transition-all';
               } else {
                   btn.disabled = true;
                   btn.className = 'px-4 py-2 text-xs font-medium sf-text border border-gray-300 text-gray-700 hover:bg-gray-50 rounded transition-all disabled:opacity-50 disabled:cursor-not-allowed';
               }
           });
       }

       function toggleCompareMode() {
           compareMode = !compareMode;
           const btn = document.getElementById('compare-btn');
           
           if (compareMode) {
               btn.textContent = 'Exit Compare Mode';
               btn.className = 'w-full py-2 px-3 rounded-lg font-medium text-sm bg-red-600 text-white hover:bg-red-700 transition-all sf-text';
               selectedPhilosophers = [];
               document.querySelectorAll('.philosopher-card').forEach(card => {
                   card.classList.remove('ring-2', 'ring-white', 'scale-105', 'ring-4', 'ring-yellow-400');
               });
               updateCompareUI();
           } else {
               btn.textContent = 'Compare Selected';
               btn.className = 'w-full py-2 px-3 rounded-lg font-medium text-sm bg-purple-600 text-white hover:bg-purple-700 transition-all sf-text disabled:bg-gray-300';
               btn.disabled = true;
               selectedPhilosophers = [];
               document.querySelectorAll('.philosopher-card').forEach(card => {
                   card.classList.remove('ring-4', 'ring-yellow-400');
               });
               updateButtons();
           }
       }

       function updateCompareUI() {
           const countEl = document.getElementById('selected-count');
           countEl.textContent = selectedPhilosophers.length + ' selected';
           
           if (compareMode) {
               document.querySelectorAll('button[onclick^="getCommentary"]').forEach(btn => {
                   if (selectedPhilosophers.length >= 2) {
                       btn.innerHTML = '<span class="button-text">Compare Analyses</span>';
                       btn.disabled = false;
                       btn.className = 'w-full py-2 px-3 rounded-lg font-medium text-xs transition-all sf-text bg-purple-600 text-white hover:bg-purple-700';
                   } else {
                       btn.innerHTML = '<span class="button-text">Select 2-3 for Compare</span>';
                       btn.disabled = true;
                       btn.className = 'w-full py-2 px-3 rounded-lg font-medium text-xs transition-all sf-text bg-gray-100 text-gray-400 cursor-not-allowed';
                   }
               });
           }
       }

       function getHistoricalContext(id) {
           const contexts = {
               'aristotle': 'During Aristotle\'s era (384-322 BCE), political power was concentrated in city-states ruled by kings or oligarchies. His concept of mixed government and rule of law would find this concentration of executive power deeply concerning for democratic stability.',
               'plato': 'Plato witnessed the decline of Athenian democracy and Socrates\' execution by democratic mob rule. His philosopher-king ideal suggests he would view this expansion of executive power as evidence of democracy\'s inherent flaws.',
               'kant': 'Writing during the Enlightenment, Kant emphasized constitutional limits on power and the categorical imperative. He would likely view this decision as violating the principle that actions should be universalizable.',
               'nietzsche': 'Nietzsche lived through the rise of German nationalism and criticized mass democracy. He would see this as evidence of the "herd mentality" and the need for strong individual leadership beyond conventional morality.',
               'marx': 'Marx analyzed how capitalist systems concentrate power in ruling classes. He would interpret this decision as the bourgeois state apparatus protecting elite interests against democratic constraints.',
               'mlk': 'Dr. King fought against institutional power structures that oppressed marginalized communities. He would likely view expanded executive power as a threat to civil rights and democratic participation.',
               'jesus': 'Jesus taught about power serving others rather than self-interest. He would likely emphasize how political power should be used to help the vulnerable rather than consolidate authority.',
               'putin': 'Having consolidated power in Russia since 1999, Putin understands executive authority as necessary for national stability and sovereignty against external threats.',
               'chomsky': 'Chomsky has consistently criticized the concentration of power in both corporate and government institutions as fundamentally anti-democratic.',
               'trump': 'As a former president, Trump would likely view expanded executive power as necessary for effective governance and protecting national interests.',
               'musk': 'Musk\'s experience with regulatory agencies would inform his view on whether executive power helps or hinders innovation and progress.'
           };
           return contexts[id] || 'This philosopher would bring their unique historical perspective to this contemporary political development.';
       }

       function getPhilosopherBio(id) {
           const bios = {
               'aristotle': '384-322 BCE • Student of Plato, tutor to Alexander the Great • <a href="https://plato.stanford.edu/entries/aristotle/" class="text-blue-600 hover:underline">Stanford Encyclopedia</a>',
               'plato': '428-348 BCE • Founded the Academy in Athens • <a href="https://plato.stanford.edu/entries/plato/" class="text-blue-600 hover:underline">Stanford Encyclopedia</a>',
               'kant': '1724-1804 • German Enlightenment philosopher • <a href="https://plato.stanford.edu/entries/kant/" class="text-blue-600 hover:underline">Stanford Encyclopedia</a>',
               'nietzsche': '1844-1900 • German philosopher and cultural critic • <a href="https://plato.stanford.edu/entries/nietzsche/" class="text-blue-600 hover:underline">Stanford Encyclopedia</a>',
               'marx': '1818-1883 • German philosopher and economist • <a href="https://plato.stanford.edu/entries/marx/" class="text-blue-600 hover:underline">Stanford Encyclopedia</a>',
               'mlk': '1929-1968 • American civil rights leader • <a href="https://kinginstitute.stanford.edu/" class="text-blue-600 hover:underline">King Institute</a>',
               'jesus': 'c. 4 BCE - 30/33 CE • Central figure of Christianity • <a href="https://plato.stanford.edu/entries/jesus/" class="text-blue-600 hover:underline">Historical Jesus</a>',
               'putin': 'b. 1952 • President of Russia since 1999 • <a href="https://en.kremlin.ru/" class="text-blue-600 hover:underline">Official Site</a>',
               'chomsky': 'b. 1928 • American linguist and political activist • <a href="https://chomsky.info/" class="text-blue-600 hover:underline">Official Site</a>',
               'trump': 'b. 1946 • 45th President of the United States • <a href="https://www.donaldjtrump.com/" class="text-blue-600 hover:underline">Official Site</a>',
               'musk': 'b. 1971 • CEO of Tesla and SpaceX • <a href="https://twitter.com/elonmusk" class="text-blue-600 hover:underline">Twitter</a>'
           };
           return bios[id] || '';
       }

       function getPhilosopherName(id) {
           const names = {
               'aristotle': 'Aristotle', 'plato': 'Plato', 'kant': 'Kant',
               'nietzsche': 'Nietzsche', 'marx': 'Marx', 'mlk': 'MLK',
               'jesus': 'Jesus', 'putin': 'Putin', 'chomsky': 'Chomsky',
               'trump': 'Trump', 'musk': 'Musk'
           };
           return names[id] || 'Philosopher';
       }

       async function loadNews() {
           try {
               const response = await fetch('/api/news');
               const stories = await response.json();
               displayNews(stories);
           } catch (error) {
               console.error('Error loading news:', error);
               document.getElementById('news-container').innerHTML = '<div class="col-span-full text-center py-8"><p class="text-red-600">Error loading news</p></div>';
           }
       }

       function displayNews(stories) {
           const container = document.getElementById('news-container');
           const loadingEl = document.getElementById('news-loading');
           if(loadingEl) loadingEl.remove();

           stories.forEach((story, index) => {
               const card = document.createElement('div');
               card.className = 'bg-white rounded-lg shadow-sm border border-gray-200 p-6 hover:shadow-md transition-all duration-200';
               card.innerHTML = 
                   '<div class="flex justify-between items-start mb-4">' +
                   '<div class="flex items-center">' +
                   '<div class="w-2 h-2 bg-red-500 rounded-full mr-3"></div>' +
                   '<span class="text-xs text-red-600 font-medium sf-text uppercase tracking-wide">Current</span>' +
                   '</div>' +
                   '<span class="text-xs text-gray-500 sf-text">' + new Date(story.publishedAt).toLocaleDateString() + '</span>' +
                   '</div>' +
                   '<h3 class="text-lg font-medium serif text-gray-900 leading-tight mb-3">' + story.title + '</h3>' +
                   '<p class="text-sm sf-text text-gray-600 leading-relaxed mb-4">' + (story.description || '').substring(0, 200) + '...</p>' +
                   '<div class="flex justify-between items-center">' +
                   '<a href="' + story.url + '" target="_blank" class="text-xs text-gray-500 hover:text-gray-700 sf-text">Read source →</a>' +
                   '<button onclick="getCommentary(' + index + ')" class="px-4 py-2 text-xs font-medium sf-text border border-gray-300 text-gray-700 hover:bg-gray-50 rounded transition-all disabled:opacity-50 disabled:cursor-not-allowed" disabled>' +
                   '<span class="button-text">Select Analyst</span>' +
                   '</button>' +
                   '</div>';
               container.appendChild(card);
           });
           
           updateButtons();
       }

       async function getCommentary(storyIndex) {
           if (selectedPhilosophers.length === 0) return;
           
           const modal = document.getElementById('enhanced-modal');
           const content = document.getElementById('modal-content');
           
           modal.classList.remove('hidden');
           content.innerHTML = '<div class="text-center py-16"><div class="animate-spin rounded-full h-12 w-12 border-2 border-gray-300 border-t-gray-900 mx-auto"></div><p class="text-sm text-gray-600 mt-4 sf-text">Analyzing...</p></div>';

           try {
               const storiesResponse = await fetch('/api/news');
               const stories = await storiesResponse.json();
               const story = stories[storyIndex];
               
               if (compareMode && selectedPhilosophers.length >= 2) {
                   await generateCompareView(story, storyIndex);
               } else {
                   await generateSingleView(story, storyIndex);
               }
           } catch (error) {
               content.innerHTML = '<div class="text-center py-8"><p class="text-red-600 sf-text">Error generating analysis.</p></div>';
           }
       }

       async function generateSingleView(story, storyIndex) {
           const philosopherId = selectedPhilosophers[0];
           const response = await fetch('/api/commentary/' + philosopherId + '/' + storyIndex);
           const data = await response.json();
           
           document.getElementById('modal-title').textContent = data.philosopher + "'s Analysis";
           document.getElementById('modal-subtitle').textContent = 'Philosophical perspective';
           document.getElementById('philosopher-bio').innerHTML = getPhilosopherBio(philosopherId);
           
           const sections = data.commentary.split(/(?=STANCE:|REASONING:|RELEVANCE:|INSIGHTS:|CONCLUSION:)/);
           const conclusion = (sections.find(s => s.includes('CONCLUSION:')) || '').replace('CONCLUSION:', '').trim() || data.commentary.substring(0, 200);
           const stance = (sections.find(s => s.includes('STANCE:')) || '').replace('STANCE:', '').trim();
           const reasoning = (sections.find(s => s.includes('REASONING:')) || '').replace('REASONING:', '').trim();
           const relevance = (sections.find(s => s.includes('RELEVANCE:')) || '').replace('RELEVANCE:', '').trim();
           const insights = (sections.find(s => s.includes('INSIGHTS:')) || '').replace('INSIGHTS:', '').trim();
           
           let html = '<div class="space-y-8">' +
               // Academic citation header
               '<div class="border-b border-gray-200 pb-6">' +
               '<div class="flex items-center mb-4">' +
               '<div class="philosopher-silhouette">' + data.philosopher.split(' ').map(n => n[0]).join('') + '</div>' +
               '<div class="ml-4">' +
               '<h3 class="text-xl font-bold serif text-gray-900">' + data.philosopher + '</h3>' +
               '<p class="text-sm text-gray-600 sf-text">Philosophical Analysis</p>' +
               '</div>' +
               '</div>' +
               '<div class="bg-gray-50 p-4 rounded-lg border-l-4 border-gray-300">' +
               '<h4 class="text-xs font-medium text-gray-500 uppercase tracking-wide mb-2 mono">Source Material</h4>' +
               '<h5 class="text-base font-medium text-gray-900 serif mb-1">' + data.story.title + '</h5>' +
               '<p class="text-sm text-gray-700 sf-text leading-relaxed mb-2">' + data.story.description + '</p>' +
               '<p class="text-xs text-gray-500 mono">BBC News • 2025</p>' +
               '</div>' +
               '</div>' +
               
               // Pull quote from conclusion
               '<div class="text-center py-8 fade-in">' +
               '<div class="relative inline-block quote-marks">' +
               '<p class="text-2xl font-light serif text-gray-800 leading-relaxed max-w-2xl">' + conclusion + '</p>' +
               '</div>' +
               '<p class="text-sm text-gray-500 mt-4 serif">— Final Assessment of ' + data.philosopher + '</p>' +
               '</div>' +
               
               // Academic sections
               '<div class="space-y-6">';
           
           if (relevance) {
               html += '<div class="bg-white p-8 rounded-xl shadow-sm border border-gray-100 fade-in">' +
                   '<h5 class="text-xl font-bold serif text-gray-900 mb-4">Contemporary Analysis</h5>' +
                   '<p class="text-base sf-text text-gray-800 leading-relaxed">' + relevance + '</p>' +
                   '</div>';
           }
           
           if (stance) {
               html += '<div class="bg-white p-8 rounded-xl shadow-sm border border-gray-100 fade-in">' +
                   '<h5 class="text-xl font-bold serif text-gray-900 mb-4">Philosophical Position</h5>' +
                   '<p class="text-base sf-text text-gray-800 leading-relaxed">' + stance + '</p>' +
                   '</div>';
           }
           
           if (insights) {
               html += '<div class="bg-white p-8 rounded-xl shadow-sm border border-gray-100 fade-in">' +
                   '<h5 class="text-xl font-bold serif text-gray-900 mb-6">Key Observations</h5>' +
                   '<div class="space-y-4">';
               
               const insightsList = insights.split(/(?=\d+\.)/).filter(item => item.trim());
               insightsList.forEach((item, index) => {
                   const cleanedItem = item.trim().replace(/^\d+\.\s*/, '');
                   html += '<div class="flex items-start">' +
                       '<span class="mono text-sm font-medium text-gray-400 mr-4 mt-1">' + (index + 1).toString().padStart(2, '0') + '</span>' +
                       '<p class="text-base sf-text text-gray-800 leading-relaxed">' + cleanedItem + '</p>' +
                       '</div>';
               });
               
               html += '</div></div>';
           }
           
           if (reasoning) {
               html += '<div class="bg-white p-8 rounded-xl shadow-sm border border-gray-100 fade-in">' +
                   '<h5 class="text-xl font-bold serif text-gray-900 mb-4">Philosophical Framework</h5>' +
                   '<p class="text-base sf-text text-gray-800 leading-relaxed">' + reasoning + '</p>' +
                   '</div>';
           }
           
           // Historical context
           html += '<div class="bg-gray-50 p-8 rounded-xl border border-gray-200 fade-in">' +
               '<h5 class="text-xl font-bold serif text-gray-900 mb-4">Historical Context</h5>' +
               '<p class="text-sm sf-text text-gray-700 leading-relaxed">' + 
               getHistoricalContext(philosopherId) +
               '</p>' +
               '</div>';
           
           html += '</div></div>';
           
           document.getElementById('modal-content').innerHTML = html;
       }

       async function generateCompareView(story, storyIndex) {
           document.getElementById('modal-title').textContent = 'Comparative Analysis';
           document.getElementById('modal-subtitle').textContent = selectedPhilosophers.length + ' perspectives';
           
           const analyses = await Promise.all(
               selectedPhilosophers.map(async (philosopherId) => {
                   const response = await fetch('/api/commentary/' + philosopherId + '/' + storyIndex);
                   const data = await response.json();
                   return { philosopherId, data };
               })
           );
           
           let html = '<div class="space-y-6">' +
               '<div class="border-b border-gray-100 pb-4">' +
               '<h4 class="text-xs text-gray-500 uppercase tracking-wide mb-2 sf-text">Breaking News • 2025</h4>' +
               '<h5 class="text-lg font-medium text-gray-900 mb-2 sf-pro">' + story.title + '</h5>' +
               '<p class="text-gray-600 sf-text">' + story.description + '</p>' +
               '</div><div class="grid gap-6">';
           
           analyses.forEach(({ philosopherId, data }) => {
               const sections = data.commentary.split(/(?=STANCE:|REASONING:|RELEVANCE:|INSIGHTS:|CONCLUSION:)/);
               const relevance = (sections.find(s => s.includes('RELEVANCE:')) || '').replace('RELEVANCE:', '').trim();
               const stance = (sections.find(s => s.includes('STANCE:')) || '').replace('STANCE:', '').trim();
               
               html += '<div class="border rounded-xl p-6 bg-gray-50">' +
                   '<h3 class="text-lg font-semibold text-gray-900 sf-pro mb-4">' + data.philosopher + '</h3>';
               
               if (relevance) {
                   html += '<div class="mb-4">' +
                       '<h4 class="text-sm font-medium text-gray-700 mb-2 sf-pro">Take</h4>' +
                       '<p class="text-sm text-gray-800 sf-text">' + relevance.substring(0, 150) + '...</p>' +
                       '</div>';
               }
               
               if (stance) {
                   html += '<div>' +
                       '<h4 class="text-sm font-medium text-gray-700 mb-2 sf-pro">Position</h4>' +
                       '<p class="text-sm text-gray-800 sf-text">' + stance.substring(0, 150) + '...</p>' +
                       '</div>';
               }
               
               html += '</div>';
           });
           
           html += '</div></div>';
           document.getElementById('modal-content').innerHTML = html;
       }

       function closeEnhancedModal() {
           document.getElementById('enhanced-modal').classList.add('hidden');
       }

       loadNews();
   </script>
</body>
</html>