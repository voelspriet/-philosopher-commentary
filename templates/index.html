<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Philosophy Meets Current Events</title>
   <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-slate-50 via-blue-50 to-purple-50 min-h-screen">
   <div class="container mx-auto px-4 py-8">
       <div class="text-center mb-8">
           <h1 class="text-3xl font-bold bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 bg-clip-text text-transparent mb-4">
               Philosophy Meets Current Events
           </h1>
           <p class="text-sm text-gray-700 font-medium">ðŸ”´ LIVE: What would history's greatest minds think about breaking news in 2025?</p>
       </div>

       <div class="grid grid-cols-12 gap-8">
           <div class="col-span-4">
               <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-6">
                   <h2 class="text-xl font-bold text-gray-800 mb-4 text-center">Choose Your Philosopher</h2>
                   
                   <div class="mb-6">
                       <h3 class="text-lg font-semibold text-gray-700 mb-3">ðŸ“œ Classical Thinkers</h3>
                       <div class="grid grid-cols-2 gap-3">
                           {% for id, philosopher in philosophers.items() if philosopher.era == "classical" %}
                           <div class="philosopher-card bg-gradient-to-br {{ philosopher.color }} backdrop-blur-sm p-3 rounded-2xl cursor-pointer text-white text-center shadow-xl" 
                                onclick="selectPhilosopher('{{ id }}')">
                               <div class="text-xl mb-1">{{ philosopher.image }}</div>
                               <h3 class="font-semibold text-xs">{{ philosopher.name.split()[0] }}</h3>
                           </div>
                           {% endfor %}
                       </div>
                   </div>
                   
                   <div>
                       <h3 class="text-lg font-semibold text-gray-700 mb-3">ðŸŽ¤ Contemporary Voices</h3>
                       <div class="grid grid-cols-2 gap-3">
                           {% for id, philosopher in philosophers.items() if philosopher.era == "contemporary" %}
                           <div class="philosopher-card bg-gradient-to-br {{ philosopher.color }} backdrop-blur-sm p-3 rounded-2xl cursor-pointer text-white text-center shadow-xl" 
                                onclick="selectPhilosopher('{{ id }}')">
                               <div class="text-xl mb-1">{{ philosopher.image }}</div>
                               <h3 class="font-semibold text-xs">{{ philosopher.name.split()[0] }}</h3>
                           </div>
                           {% endfor %}
                       </div>
                   </div>
               </div>
           </div>

           <div class="col-span-8">
               <h2 class="text-xl font-bold mb-4">ðŸ”´ Breaking News</h2>
               <div id="news-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                   <div id="news-loading" class="col-span-full text-center py-16">
                       <div class="animate-spin rounded-full h-16 w-16 border-4 border-blue-600 border-t-transparent mx-auto"></div>
                       <p class="mt-6 text-lg text-gray-600">Loading headlines...</p>
                   </div>
               </div>
           </div>
       </div>
   </div>

   <div id="commentary-modal" class="fixed inset-0 bg-black/70 backdrop-blur-sm hidden z-50 flex items-center justify-center p-4">
       <div class="bg-white rounded-2xl max-w-4xl w-full max-h-[85vh] overflow-y-auto shadow-2xl">
           <div class="sticky top-0 bg-white rounded-t-2xl border-b border-gray-200 p-4">
               <div class="flex justify-between items-start">
                   <div class="flex items-center">
                       <span id="modal-philosopher-image" class="text-3xl mr-3"></span>
                       <h3 id="modal-title" class="text-xl font-bold text-gray-800"></h3>
                   </div>
                   <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 text-2xl">Ã—</button>
               </div>
           </div>
           <div id="modal-content" class="p-6"></div>
       </div>
   </div>

   <script>
       let selectedPhilosopher = null;
       const philosophers = {{ philosophers|tojson }};

       async function loadNews() {
           const response = await fetch('/api/news');
           const stories = await response.json();
           displayNews(stories);
       }

       function displayNews(stories) {
           const container = document.getElementById('news-container');
           const loadingEl = document.getElementById('news-loading');
           if(loadingEl) loadingEl.remove();

           stories.forEach((story, index) => {
               const card = document.createElement('div');
               card.className = 'bg-white/90 rounded-2xl shadow-xl hover:shadow-2xl transition-all duration-300';
               card.innerHTML = `
                   <div class="p-3">
                       <div class="flex justify-between items-start mb-2">
                           <span class="text-xs text-red-600 font-bold bg-red-100 px-2 py-1 rounded">ðŸ”´ LIVE</span>
                           <span class="text-xs text-gray-500">${new Date(story.publishedAt).toLocaleDateString()}</span>
                       </div>
                       <h3 class="font-bold text-xs mb-2 text-gray-900 leading-tight">${story.title}</h3>
                       <p class="text-gray-600 text-xs mb-3 leading-relaxed">${(story.description || '').substring(0, 150)}...</p>
                       <a href="${story.url}" target="_blank" class="text-xs text-blue-500 hover:underline mb-2 block">ðŸ“° Read full BBC article</a>
                       <button onclick="getCommentary(${index})" 
                               class="w-full py-2 px-3 rounded-lg font-semibold text-xs transition-all ${!selectedPhilosopher ? 
                               'bg-gray-300 text-gray-500 cursor-not-allowed' : 
                               'bg-gradient-to-r from-blue-600 to-purple-600 text-white hover:shadow-lg'}"
                               ${!selectedPhilosopher ? 'disabled' : ''}>
                           <span class="button-text">${selectedPhilosopher ? 'Get ' + philosophers[selectedPhilosopher].name.split()[0] + ' Analysis' : 'Select Philosopher'}</span>
                       </button>
                   </div>
               `;
               container.appendChild(card);
           });
       }

       function selectPhilosopher(philosopherId) {
           selectedPhilosopher = philosopherId;
           
           document.querySelectorAll('.philosopher-card').forEach(card => {
               card.classList.remove('ring-4', 'ring-white', 'scale-105');
           });
           event.target.closest('.philosopher-card').classList.add('ring-4', 'ring-white', 'scale-105');

           document.querySelectorAll('.button-text').forEach(btn => {
               btn.textContent = 'Get ' + philosophers[philosopherId].name.split()[0] + ' Analysis';
           });
           
           document.querySelectorAll('button[onclick^="getCommentary"]').forEach(btn => {
               btn.disabled = false;
               btn.className = btn.className.replace('bg-gray-300 text-gray-500 cursor-not-allowed', 'bg-gradient-to-r from-blue-600 to-purple-600 text-white hover:shadow-lg');
           });
       }

       async function getCommentary(storyIndex) {
           if (!selectedPhilosopher) return;

           const modal = document.getElementById('commentary-modal');
           const content = document.getElementById('modal-content');
           
           modal.classList.remove('hidden');
           document.getElementById('modal-philosopher-image').textContent = philosophers[selectedPhilosopher].image;
           document.getElementById('modal-title').textContent = philosophers[selectedPhilosopher].name + "'s Analysis";
           
           content.innerHTML = '<div class="text-center py-16"><div class="text-6xl mb-4 animate-pulse">' + philosophers[selectedPhilosopher].image + '</div><p class="text-lg text-gray-600">Channeling philosophical wisdom...</p></div>';

           try {
               const storiesResponse = await fetch('/api/news');
               const stories = await storiesResponse.json();
               const story = stories[storyIndex];
               
               const response = await fetch('/api/commentary/' + selectedPhilosopher + '/' + storyIndex);
               const data = await response.json();
               
               const sections = data.commentary.split(/(?=STANCE:|REASONING:|RELEVANCE:|INSIGHTS:|CONCLUSION:)/);
               const conclusion = sections.find(s => s.includes('CONCLUSION:'))?.replace('CONCLUSION:', '').trim() || '';
               const stance = sections.find(s => s.includes('STANCE:'))?.replace('STANCE:', '').trim() || '';
               const reasoning = sections.find(s => s.includes('REASONING:'))?.replace('REASONING:', '').trim() || '';
               const relevance = sections.find(s => s.includes('RELEVANCE:'))?.replace('RELEVANCE:', '').trim() || '';
               const insights = sections.find(s => s.includes('INSIGHTS:'))?.replace('INSIGHTS:', '').trim() || '';
               
               content.innerHTML = `
                   <div class="space-y-6">
                       <div class="border-b border-gray-200 pb-4">
                           <h4 class="text-sm text-gray-500 uppercase tracking-wide mb-2">Breaking News</h4>
                           <h5 class="text-xl font-bold text-gray-900 mb-2">${story.title}</h5>
                           <p class="text-gray-600">${story.description}</p>
                       </div>
                       
                       <div class="bg-gradient-to-r ${data.color} text-white rounded-lg p-8">
                           <div class="flex items-center justify-between mb-6">
                               <div>
                                   <span class="text-4xl">${data.image}</span>
                                   <h3 class="text-2xl font-light mt-2">${data.philosopher}</h3>
                               </div>
                           </div>
                           
                           <div class="bg-black/20 rounded-lg p-6 mb-6">
                               <h4 class="text-lg font-medium text-white/90 mb-3">Final Judgment</h4>
                               <p class="text-xl leading-relaxed font-light">${conclusion}</p>
                           </div>
                           
                           <div class="grid gap-4">
                               <div class="bg-white/10 rounded p-4">
                                   <h5 class="font-medium text-white/80 mb-2">Position</h5>
                                   <p class="text-white/95">${stance}</p>
                               </div>
                               
                               <div class="bg-white/10 rounded p-4">
                                   <h5 class="font-medium text-white/80 mb-2">Reasoning</h5>
                                   <p class="text-white/95">${reasoning}</p>
                               </div>
                               
                               <div class="bg-white/10 rounded p-4">
                                   <h5 class="font-medium text-white/80 mb-2">2025 Relevance</h5>
                                   <p class="text-white/95">${relevance}</p>
                               </div>
                               
                               <div class="bg-white/10 rounded p-4">
                                   <h5 class="font-medium text-white/80 mb-2">Key Insights</h5>
                                   <p class="text-white/95">${insights}</p>
                               </div>
                           </div>
                       </div>
                   </div>
               `;
               
           } catch (error) {
               content.innerHTML = '<div class="text-center py-8"><p class="text-red-600">Error generating analysis.</p></div>';
           }
       }

       function closeModal() {
           document.getElementById('commentary-modal').classList.add('hidden');
       }

       loadNews();
   </script>
</body>
</html>
